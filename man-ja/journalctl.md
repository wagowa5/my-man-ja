# journalctl - systemdジャーナルを照会するコマンド

## 概要
`journalctl` は、`systemd-journald.service` によって書き込まれた systemd ジャーナルの内容を照会するために使用されます。

## シノプシス
```bash
journalctl [オプション...] [マッチ条件...]
```

## 説明
`journalctl` は、`systemd-journald.service(8)` によって書き込まれた systemd ジャーナルの内容を照会するために使用されます。

パラメータなしで呼び出された場合、収集された最も古いエントリから始まるジャーナルの全内容が表示されます。

1つ以上のマッチ引数が渡された場合、出力はそれに応じてフィルタリングされます。マッチは `"FIELD=VALUE"` の形式であり、例えば `"_SYSTEMD_UNIT=httpd.service"` のように、構造化されたジャーナルエントリのコンポーネントを参照します。よく知られたフィールドのリストについては `systemd.journal-fields(7)` を参照してください。異なるフィールドにマッチする複数のマッチが指定された場合、ログエントリは両方でフィルタリングされます。つまり、結果の出力には、この種類のすべての指定されたマッチに一致するエントリのみが表示されます。同じフィールドに2つのマッチが適用される場合、それらは自動的に代替としてマッチされます。つまり、結果の出力には、同じフィールドに対して指定されたマッチのいずれかに一致するエントリが表示されます。最後に、文字 `+` がコマンドライン上の他の用語の間に独立した単語として現れる場合、前後のすべてのマッチが論理ORで結合されます。

絶対ファイルパスを引数として指定することでもエントリをフィルタリングすることが可能です。ファイルパスはファイルまたはシンボリックリンクであり、クエリ時にファイルが存在している必要があります。ファイルパスが実行可能なバイナリを指す場合、正規化されたバイナリパスに対する `"_EXE="` マッチがクエリに追加されます。ファイルパスが実行可能なスクリプトを指す場合、スクリプト名に対する `"_COMM="` マッチがクエリに追加されます。ファイルパスがデバイスノードを指す場合、デバイスのカーネル名およびその親デバイスごとに `"_KERNEL_DEVICE="` マッチがクエリに追加されます。シンボリックリンクは逆参照され、カーネル名が合成され、親デバイスはクエリ時の環境から識別されます。一般的に、デバイスノードは実際のデバイスの最良のプロキシであり、ログエントリには通常、実際のデバイスを識別するフィールドが含まれていません。実際のデバイスに対して正しいログエントリを得るためには、エントリがログに記録された時点の環境の関連部分、特にデバイスノードに対応する実際のデバイスがクエリ時と同じでなければなりません。デバイスノードは通常、再起動時に対応するデバイスが変更されるため、デバイスノードパスを指定すると、結果のエントリは現在のブートからのものに限定されます。

`--boot`、`--unit=` などのオプションを使用して追加の制約を追加することで、表示されるエントリをさらに制限することができます（論理AND）。

出力は、ローテーションされたものや現在書き込み中のもの、システム自体に属するものやユーザージャーナルに属するものに関係なく、すべてのアクセス可能なジャーナルファイルからインターリーブされます。`--header` オプションを使用して、どのファイルが表示されているかを識別できます。

使用されるジャーナルファイルのセットは、`--user`、`--system`、`--directory`、および `--file` オプションを使用して変更できます。詳細は以下を参照してください。

すべてのユーザーには、プライベートなユーザーごとのジャーナルへのアクセスが許可されています。ただし、デフォルトでは、root および少数の特別なグループのメンバーのみがシステムジャーナルおよび他のユーザーのジャーナルへのアクセスが許可されています。`systemd-journal`、`adm`、および `wheel` グループのメンバーは、すべてのジャーナルファイルを読み取ることができます。後者の2つのグループは、伝統的にディストリビューションによって指定された追加の特権を持っていることに注意してください。`wheel` グループのメンバーは、多くの場合、管理タスクを実行できます。

出力はデフォルトで `less` によってページングされ、長い行は画面幅に「切り捨てられ」ます。隠れた部分は、左矢印キーおよび右矢印キーを使用して表示できます。ページングは無効にすることができます。`--no-pager` オプションおよび以下の「環境」セクションを参照してください。

tty に出力する場合、優先度に応じて行が色付けされます：ERROR レベル以上の行は赤色で、NOTICE レベル以上の行はハイライト表示され、DEBUG レベルの行は薄いグレーで色付けされ、その他の行は通常通り表示されます。

## ソースオプション
以下のオプションは、ジャーナルレコードを読み取る場所を制御します：

### --system, --user
- システムサービスおよびカーネルからのメッセージを表示します（`--system` を使用）。
- 現在のユーザーのサービスからのメッセージを表示します（`--user` を使用）。
- どちらも指定されていない場合、ユーザーが見ることができるすべてのメッセージが表示されます。

`--user` オプションは、`--unit` 引数の扱いに影響を与えます。詳細は `--unit` を参照してください。

### -M, --machine=
- 実行中のローカルコンテナからのメッセージを表示します。接続するコンテナ名を指定します。

### -m, --merge
- 利用可能なすべてのジャーナル（リモートを含む）からのエントリをインターリーブして表示します。

### -D DIR, --directory=DIR
- ディレクトリパスを引数として取ります。指定された場合、`journalctl` はデフォルトのランタイムおよびシステムジャーナルパスの代わりに指定されたジャーナルディレクトリ `DIR` 上で動作します。

### --file=GLOB
- ファイルグロブを引数として取ります。指定された場合、`journalctl` はデフォルトのランタイムおよびシステムジャーナルパスの代わりに `GLOB` に一致する指定されたジャーナルファイル上で動作します。複数回指定でき、その場合ファイルが適切にインターリーブされます。

### --root=ROOT
- ディレクトリパスを引数として取ります。指定された場合、`journalctl` はルートディレクトリの代わりに指定されたディレクトリ `ROOT` の下にあるジャーナルディレクトリおよびカタログファイル階層上で動作します。

### --image=IMAGE
- ディスクイメージファイルまたはブロックデバイスノードへのパスを取ります。指定された場合、`journalctl` は指定されたディスクイメージ内のファイルシステム上で動作します。このオプションは `--root=` に似ていますが、ディスクイメージまたはブロックデバイスに格納されたファイルシステム上で動作するため、ディスクイメージからログデータを抽出する簡単な方法を提供します。

### --namespace=NAMESPACE
- ジャーナルネームスペース識別子文字列を引数として取ります。指定されない場合、デフォルトネームスペースによって収集されたデータが表示されます。指定された場合、指定されたネームスペースのログデータが表示されます。`*` と指定された場合、すべてのネームスペースからのデータがインターリーブされて表示されます。`+` で始まる場合、指定されたネームスペースとデフォルトネームスペースのデータがインターリーブされて表示されます。他のネームスペースは表示されません。詳細は `systemd-journald.service(8)` を参照してください。

## フィルタリングオプション
以下のオプションは、ジャーナルレコードのフィルタリング方法を制御します：

### -S, --since=, -U, --until=
- 指定された日時以降または以前のエントリを表示します。日時の指定は `"YYYY-MM-DD HH:MM:SS"` の形式である必要があります。時間部分が省略された場合は `"00:00:00"` が仮定されます。詳細は `systemd.time(7)` を参照してください。

### -c, --cursor=
- 渡されたカーソルで指定されたジャーナル内の位置からエントリの表示を開始します。

### --after-cursor=
- 渡されたカーソルで指定された位置の後からエントリの表示を開始します。カーソルは `--show-cursor` オプションが使用された場合に表示されます。

### --cursor-file=FILE
- `FILE` が存在しカーソルを含む場合、この位置の後からエントリの表示を開始します。そうでない場合は、他の指定されたオプションに従ってエントリを表示します。最後に、最後のエントリのカーソルを `FILE` に書き込みます。このオプションを使用して、`journalctl` を順次呼び出してジャーナルを継続的に読み取ることができます。

### -b [[ID][±offset]|all], --boot[=[ID][±offset]|all]
- 特定のブートからのメッセージを表示します。これは `"_BOOT_ID="` のマッチを追加します。

### -u, --unit=UNIT|PATTERN
- 指定された systemd ユニット（例：サービスユニット）のメッセージ、または PATTERN に一致するユニットのメッセージを表示します。パターンが指定された場合、ジャーナル内で見つかったユニット名のリストがパターンと比較され、一致するものが使用されます。

### その他のフィルタリングオプション
- `--user-unit=`
- `-t, --identifier=SYSLOG_IDENTIFIER`
- `-p, --priority=`
- `--facility=`
- `-g, --grep=`
- `--case-sensitive[=BOOLEAN]`
- `-k, --dmesg`

## 出力オプション
以下のオプションは、ジャーナルレコードの表示方法を制御します：

### -o, --output=
- ジャーナルエントリのフォーマットを制御します。以下のオプションから選択できます：
  - `short`
  - `short-full`
  - `short-iso`
  - `short-iso-precise`
  - `short-precise`
  - `short-monotonic`
  - `short-delta`
  - `short-unix`
  - `verbose`
  - `export`
  - `json`
  - `json-pretty`
  - `json-sse`
  - `json-seq`
  - `cat`
  - `with-unit`

### --output-fields=
- 出力に含めるフィールドのカンマ区切りリストを指定します。

### -n, --lines=
- 最新のジャーナルイベントを表示し、表示されるイベント数を制限します。

### -r, --reverse
- 出力を逆順にして、最新のエントリが最初に表示されるようにします。

### その他の出力オプション
- `--show-cursor`
- `--utc`
- `-x, --catalog`
- `--no-hostname`
- `--no-full, --full, -l`
- `-a, --all`
- `-f, --follow`
- `--no-tail`
- `-q, --quiet`

## ページャー制御オプション
以下のオプションはページサポートを制御します：

### --no-pager
- 出力をページャーにパイプしません。

### -e, --pager-end
- ページャー内でジャーナルの末尾に即座にジャンプします。

## フォワードセキュアシーリング（FSS）オプション
以下のオプションは、`--setup-keys` コマンドと共に使用できます：

### --interval=
- シーリングキーの変更間隔を指定します。

### --verify-key=
- FSS 検証キーを指定します。

### --force
- `--setup-keys` が渡され、FSS が既に設定されている場合、FSS キーを再生成します。

## コマンド
以下のコマンドが理解されます。指定がない場合、デフォルトでジャーナルレコードが表示されます：

### -N, --fields
- ジャーナルのすべてのエントリで現在使用されているすべてのフィールド名を表示します。

### -F, --field=
- 指定されたフィールドがジャーナルのすべてのエントリで取ることができるすべてのデータ値を表示します。

### --list-boots
- ブート番号、ID、およびブートに関連する最初と最後のメッセージのタイムスタンプの表形式リストを表示します。

### --disk-usage
- すべてのジャーナルファイルの現在のディスク使用量を表示します。

### --vacuum-size=, --vacuum-time=, --vacuum-files=
- 古いジャーナルファイルを削除してディスク使用量を減らします。

### --verify
- ジャーナルファイルの内部整合性をチェックします。

### --sync
- ジャーナルデーモンにすべての未書き込みのジャーナルデータをバックアップファイルシステムに書き込み、すべてのジャーナルを同期するよう要求します。

### --relinquish-var
- ジャーナルデーモンに `--flush` の逆操作を要求します。

### --smart-relinquish-var
- `--relinquish-var` に似ていますが、ルートファイルシステムと `/var/log/journal/` が同じマウントポイント上にある場合は操作を実行しません。

### --flush
- ジャーナルデーモンに `/run/log/journal/` に保存されているログデータを `/var/log/journal/` にフラッシュするよう要求します。

### --rotate
- ジャーナルデーモンにジャーナルファイルをローテートするよう要求します。

### --header
- ジャーナルの内容を表示する代わりに、アクセスされたジャーナルフィールドの内部ヘッダー情報を表示します。

### --list-catalog [128-bit-ID...]
- メッセージカタログの内容をメッセージIDとその短い説明文字列の表としてリストします。

### --dump-catalog [128-bit-ID...]
- メッセージカタログの内容を表示します。

### --update-catalog
- メッセージカタログインデックスを更新します。

### --setup-keys
- ジャーナルの内容を表示する代わりに、Forward Secure Sealing（FSS）の新しいキー ペアを生成します。

### -h, --help
- 短いヘルプテキストを表示して終了します。

### --version
- 短いバージョン文字列を表示して終了します。

## 終了ステータス
成功した場合は `0` が返され、そうでない場合は非ゼロの失敗コードが返されます。

## 環境変数
- `$SYSTEMD_LOG_LEVEL`
- `$SYSTEMD_LOG_COLOR`
- `$SYSTEMD_LOG_TIME`
- `$SYSTEMD_LOG_LOCATION`
- `$SYSTEMD_LOG_TID`
- `$SYSTEMD_LOG_TARGET`
- `$SYSTEMD_PAGER`
- `$SYSTEMD_LESS`
- `$SYSTEMD_LESSCHARSET`
- `$SYSTEMD_PAGERSECURE`
- `$SYSTEMD_COLORS`
- `$SYSTEMD_URLIFY`

詳細は元のマニュアルページを参照してください。

## 使用例
### 引数なしで、すべての収集されたログをフィルタリングせずに表示：
```bash
journalctl
```

### 1つのマッチを指定して、フィールドが一致するすべてのエントリを表示：
```bash
journalctl _SYSTEMD_UNIT=avahi-daemon.service
journalctl _SYSTEMD_CGROUP=/user.slice/user-42.slice/session-c1.scope
```

### 異なる2つのフィールドにマッチする場合、両方の条件を満たすエントリのみを表示：
```bash
journalctl _SYSTEMD_UNIT=avahi-daemon.service _PID=28097
```

### 同じフィールドに対する2つのマッチが指定された場合、どちらかに一致するエントリを表示：
```bash
journalctl _SYSTEMD_UNIT=avahi-daemon.service _SYSTEMD_UNIT=dbus.service
```

### セパレータ `+` を使用して、2つの条件を論理ORで結合：
```bash
journalctl _SYSTEMD_UNIT=avahi-daemon.service _PID=28097 + _SYSTEMD_UNIT=dbus.service
```

### D-Bus実行可能ファイルによって生成されたすべてのログを表示：
```bash
journalctl /usr/bin/dbus-daemon
```

### 前回のブートからのすべてのカーネルログを表示：
```bash
journalctl -k -b -1
```

### システムサービス `apache.service` からのライブログディスプレイを表示：
```bash
journalctl -f -u apache
```

## 関連資料
`systemd(1)`, `systemd-journald.service(8)`, `systemctl(1)`, `coredumpctl(1)`, `systemd.journal-fields(7)`, `journald.conf(5)`, `systemd.time(7)`, `systemd-journal-remote.service(8)`, `systemd-journal-upload.service(8)`

## 注記
1. [Discoverable Partitions Specification](https://systemd.io/DISCOVERABLE_PARTITIONS)
2. [Journal Export Format](https://systemd.io/JOURNAL_EXPORT_FORMATS#journal-export-format)
3. [Journal JSON Format](https://systemd.io/JOURNAL_EXPORT_FORMATS#journal-json-format)
4. [Server-Sent Events](https://developer.mozilla.org/en-US/docs/Server-sent_events/Using_server-sent_events)
5. [JavaScript Object Notation (JSON) Text Sequences](https://tools.ietf.org/html/rfc7464)
6. [Message Catalog Developer Documentation](https://www.freedesktop.org/wiki/Software/systemd/catalog)
